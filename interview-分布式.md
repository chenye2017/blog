```
什么是分布式，分布式的优缺点。

单体服务（巨无霸）-》各个微服务。

优点
1.系统可用性提升。（不会一个挂了导致整个集群挂了， b站抢票导致电商整体都挂了）

2.并发性提升。有瓶颈的服务可以水平扩容。

缺点
1.各个服务之间的交互依赖网络，网络有延迟。

2.维护成本高。之前就一个服务，现在拆分成多个服务。

```



```
微服务和 分布式的关系

微服务是分布式的一种落地
```



```
1.学习下b站的微服务框架

2.grpc 相关。

b站的微服务框架是什么

b站的注册中心用的什么

b站的监控用的什么
```



![](https://cytuchuang-1256930988.cos.ap-shanghai.myqcloud.com/img/20230512093436.png)

```
rpc框架的基本原理

1.容器启动，服务端去注册中心注册自己的ip和端口号。

2.客户端去注册中心通过唯一id 去拉取需要服务可提供的对外 ip列表。

3.客户端根据一定的策略，随机 or 轮训从 ip列表中选择一个进行调用

4.统计功能。rpc框架都提供监控能力，监控服务健康状况。
```



```
服务启动的时候服务基本信息被注册到注册中心，如果服务提供者挂了，注册中心如何知道服务不可用了呢

服务下线分为主动下线（摘流） 和 心跳检测。

主动下线：在重启之前先主动通知注册中心：我要重启了，有流量进来先不要分给我，让别的机器服务，等我重启成功后在放流量进来，或者是在管理后台手动直接摘掉机器，

心跳检测：是处理服务非正常下线（如断电断网）的情况，这个时候如果注册中心不知道该服务已经掉线，一旦被其调用就会带来问题。为了避免出现这样的情况，注册中心增加一个心跳检测功能，它会对服务提供者（Provider）进行心跳检测，比如每隔 30s 发送一个心跳，如果三次心跳结果都没有返回值，就认为该服务已下线，赶紧更新 Consumer 的服务列表，告诉 Consumer 调用别的机器。（健康检查，ping）
```



```
如果注册中心挂了，比如你用的是 Zookeeper，如果 Zookeeper 挂了，那服务之间还能相互调用吗

首先注册中心挂掉也要分两种情况，如果数据库挂了，ZK 还是能用的，因为 ZK 会缓存注册机列表在缓存里。

其次 ZK 本身就是一个集群的，一台机器挂了，ZK 会选举出集群中的其他机器作为 Master 继续提供服务，如果整个集群都挂了也没问题，因为调用者本地会缓存注册中心获取的服务列表。省略和注册中心的交互，Consumer 和 Provider 采用直连方式，这些策略都是可配置的。
```



```
已经有 http 协议接口，或者说 RestFul 接口，为什么还要使用 RPC 技术. (grpc 对比下)


在接⼝不多的情况下，使用 http 确实是一个明智的选择，比如在初创企业，我们不确定业务能顺利开展下去，可能面临随时倒闭，开发人员也不足，这个时候使用简洁高效的技术，先把东西做出来是最明智的选择，无需一步登天。

系统与系统交互较少的情况下，使用 http 协议优点显而易见：开发简单、测试也比较直接、部署方便，利用现成的 http 协议进行系统间通讯，如果业务真的慢慢做大，系统也慢慢扩大，RPC 框架的好处就显示出来 了，⾸先 RPC 支持长链接，通信不必每次都要像 http 一样去重复 3 次握⼿，减少了网络开销。

其次就是 RPC 框架一般都有注册中心模块，有完善的监控管理功能，服务注册发现、服务下线、服务动态扩展等都方便操作，服务化治理效率大大提高。

基于 TCP 协议实现的 RPC，能更灵活地对协议字段进行定制，相比 http 能减少网络传输字节数，降低网络开销（握手）提高性能。实现更大的吞吐量和并发数，但是需要更多的关注底层复杂的细节， 对开发人员的要求也高，增加开发成本。
```



![](https://cytuchuang-1256930988.cos.ap-shanghai.myqcloud.com/img/20230512094741.png)

```
cap 理论

C 的全拼是 Consistency，代表 一致性的意思。
A 的全拼是 Availability，代表 可用性的意思。
P 的全拼是 Partition tolerance，代表 分区容错性的意思。

跨机房。

上面主从节点不在一个机房，就是牺牲了一致性，保证 可用性和分区容错性。


了解下送礼多活的做法。
```



```
正向代理，反向代理。

正向代理： 代理用户端请求服务端，相对于服务器用户端是匿名的，比如单位内网使用了正向代理软件，所有员工都访问百度，但是百度看到的只有一个 IP 地址，百度也不知道到底是哪个员工访问的。(科学上网, vpn)

反向代理： 代理服务端提供服务，相对于用户服务端是匿名的，同样是访问 www.baidu.com，所有用户输入的都是一个网站或者一个 IP，但是百度背后有成千上万的服务器，你也不知道你访问的是哪一个。

```



```
反向代理的好处

1.让 IO 和服务器分离，突破 IO 性能，提高服务器吞吐能力。
2.控制流量分发，管理服务集群，起到负载均衡作用。
3. 安全性和匿名性：通过拦截前端服务器的请求，反向代理服务器可以保护其身份，并可以抵御安全攻击。它还确保可以从单个记录定位器或 URL 访问多个服务器，而不管服务端网络的结构如何。

```



```
负载均衡算法

1.轮询 

2.加权

3.随机

4.最小连接数

5.hash （一致性hash）

```



```
```



